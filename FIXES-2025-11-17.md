# ğŸ”§ Vercel éƒ¨ç½²é”™è¯¯ä¿®å¤è®°å½•

**æ—¥æœŸ**: 2025-11-17
**çŠ¶æ€**: âœ… å·²ä¿®å¤

## ğŸ“‹ é”™è¯¯æ€»ç»“

é¦–æ¬¡éƒ¨ç½²åˆ° Vercel æ—¶é‡åˆ°äº†å¤šä¸ªæ¨¡å—ç¼ºå¤±å’Œå¯¼å…¥é”™è¯¯,ä»¥ä¸‹æ˜¯å®Œæ•´çš„ä¿®å¤è®°å½•ã€‚

---

## ğŸ› ï¸ ä¿®å¤é¡¹ç›®æ¸…å•

### âœ… 1. å®‰è£…ç¼ºå¤±çš„ npm åŒ…

**é”™è¯¯åŸå› **: é¡¹ç›®ä¾èµ–äº†ä½†æœªåœ¨ package.json ä¸­å£°æ˜çš„åŒ…

**ä¿®å¤å‘½ä»¤**:
```bash
npm install @radix-ui/react-tooltip @radix-ui/react-slider @tanstack/react-virtual next-auth web-push
```

**å®‰è£…çš„åŒ…**:
- `@radix-ui/react-tooltip` - Tooltip ç»„ä»¶åŸºç¡€åº“
- `@radix-ui/react-slider` - Slider æ»‘å—ç»„ä»¶
- `@tanstack/react-virtual` - è™šæ‹Ÿæ»šåŠ¨åˆ—è¡¨
- `next-auth` - NextAuth è®¤è¯åº“ (æŸäº›ç»„ä»¶å¼•ç”¨)
- `web-push` - Web Push é€šçŸ¥

---

### âœ… 2. åˆ›å»ºç¼ºå¤±çš„ Tooltip ç»„ä»¶

**é”™è¯¯ä¿¡æ¯**:
```
Module not found: Can't resolve '@/components/ui/tooltip'
```

**ä¿®å¤**: åˆ›å»ºäº† `src/components/ui/tooltip.tsx`

**æ–‡ä»¶å†…å®¹**:
```tsx
"use client"

import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"
import { cn } from "@/lib/utils"

const TooltipProvider = TooltipPrimitive.Provider
const Tooltip = TooltipPrimitive.Root
const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      "z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }
```

**å½±å“çš„æ–‡ä»¶**:
- `src/components/features/search/SortIndicator.tsx`
- `src/components/features/search/SortPreferences.tsx`
- `src/components/features/search/SortStatusBar.tsx`

---

### âœ… 3. åˆ›å»ºç¼ºå¤±çš„ Session æ–‡ä»¶

**é”™è¯¯ä¿¡æ¯**:
```
Module not found: Can't resolve '@/lib/session'
```

**ä¿®å¤**: åˆ›å»ºäº† `src/lib/session.ts`

**æ–‡ä»¶å†…å®¹**:
```typescript
import { cookies } from 'next/headers'
import * as jose from 'jose'

export interface SessionUser {
  id: string
  email: string
  username: string
  name?: string | null
  role: string
}

export interface Session {
  user: SessionUser
}

export async function getSession(): Promise<Session | null> {
  const cookieStore = await cookies()
  const token = cookieStore.get('auth-token')?.value

  if (!token) {
    return null
  }

  try {
    const secret = new TextEncoder().encode(process.env.JWT_SECRET || 'fallback-secret-key')
    const { payload } = await jose.jwtVerify(token, secret)

    return {
      user: {
        id: payload.userId as string,
        email: payload.email as string,
        username: payload.username as string,
        name: payload.name as string | null,
        role: payload.role as string,
      },
    }
  } catch (error) {
    console.error('Session verification failed:', error)
    return null
  }
}

export async function requireSession(): Promise<Session> {
  const session = await getSession()
  if (!session) {
    throw new Error('Unauthorized')
  }
  return session
}

export async function requireAdmin(): Promise<Session> {
  const session = await requireSession()
  if (session.user.role !== 'SYSTEM_ADMIN' && session.user.role !== 'ASSET_MANAGER') {
    throw new Error('Forbidden: Admin access required')
  }
  return session
}
```

**å½±å“çš„æ–‡ä»¶**:
- `src/app/api/admin/sso/alerts/route.ts`
- `src/app/api/admin/sso/logs/route.ts`
- `src/app/api/admin/sso/monitoring/route.ts`
- `src/app/api/admin/sso/providers/[id]/route.ts`
- `src/app/api/admin/sso/providers/[id]/statistics/route.ts`
- `src/app/api/admin/sso/providers/[id]/test/route.ts`
- `src/app/api/admin/sso/providers/route.ts`
- `src/app/api/admin/sso/role-mapping/route.ts`
- `src/app/api/admin/sso/sessions/route.ts`
- `src/app/api/admin/sso/users/sync/route.ts`

---

### âœ… 4. ä¿®å¤ lucide-react å›¾æ ‡å¯¼å…¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯**:
```
Export Sync doesn't exist in target module
The export Sync was not found in module lucide-react
Did you mean to import RefreshCw?
```

**åŸå› **: lucide-react åº“ä¸­ä¸å­˜åœ¨ `Sync` å›¾æ ‡

**ä¿®å¤**: ä½¿ç”¨ `RefreshCw` å›¾æ ‡ä½œä¸ºåˆ«å

**ä¿®å¤çš„æ–‡ä»¶**:

#### æ–‡ä»¶ 1: `src/app/(main)/admin/sso/permissions/page.tsx`
```typescript
// ä¿®æ”¹å‰
import { Users, Settings, Sync, Plus, RefreshCw, ... } from 'lucide-react'

// ä¿®æ”¹å
import { Users, Settings, RefreshCw as Sync, Plus, RefreshCw, ... } from 'lucide-react'
```

#### æ–‡ä»¶ 2: `src/components/admin/sso/UserSyncPanel.tsx`
```typescript
// ä¿®æ”¹å‰
import { Sync, Users, CheckCircle, ... } from 'lucide-react'

// ä¿®æ”¹å
import { RefreshCw as Sync, Users, CheckCircle, ... } from 'lucide-react'
```

---

### âœ… 5. ä¿®å¤ tRPC å®¢æˆ·ç«¯å¯¼å‡º

**é”™è¯¯ä¿¡æ¯**:
```
Export trpc doesn't exist in target module
The export trpc was not found in module @/lib/trpc
```

**åŸå› **: å®¢æˆ·ç«¯ç»„ä»¶ä» `@/lib/trpc` å¯¼å…¥ `trpc`,ä½†è¯¥æ–‡ä»¶åªå¯¼å‡ºæœåŠ¡ç«¯çš„ procedures

**ä¿®å¤**: åœ¨ `src/lib/trpc.ts` æœ«å°¾æ·»åŠ å®¢æˆ·ç«¯ trpc é‡æ–°å¯¼å‡º

**æ·»åŠ çš„ä»£ç **:
```typescript
// é‡æ–°å¯¼å‡ºå®¢æˆ·ç«¯ tRPC å®ä¾‹ä¾›å®¢æˆ·ç«¯ç»„ä»¶ä½¿ç”¨
export { trpc } from './trpc-client'
```

**å½±å“çš„æ–‡ä»¶**:
- `src/app/(main)/applications/history/[applicationId]/page.tsx`
- `src/app/(main)/applications/history/page.tsx`
- `src/components/features/applications/ApplicationHistoryList.tsx`
- æ‰€æœ‰ä½¿ç”¨ `trpc` è¿›è¡Œ API è°ƒç”¨çš„å®¢æˆ·ç«¯ç»„ä»¶

---

## ğŸ¯ è¿˜æœ‰çš„æ½œåœ¨é—®é¢˜ (æœªåœ¨æœ¬æ¬¡ä¿®å¤,éœ€è¦æ³¨æ„)

### âš ï¸ 1. next-auth ç›¸å…³é”™è¯¯

**é”™è¯¯**:
```
Module not found: Can't resolve 'next-auth/next'
Module not found: Can't resolve 'next-auth/react'
Export authOptions doesn't exist in target module @/lib/auth
```

**æ–‡ä»¶**:
- `src/app/(main)/applications/redirect/[applicationId]/page.tsx`
- `src/app/api/platform/redirect/route.ts`
- `src/components/ui/application/PlatformRedirect.tsx`

**è¯´æ˜**:
- è¿™äº›æ–‡ä»¶å¼•ç”¨äº† NextAuth,ä½†é¡¹ç›®å®é™…ä½¿ç”¨è‡ªå®šä¹‰ JWT è®¤è¯
- è¿™äº›å¯èƒ½æ˜¯é—ç•™ä»£ç æˆ–æœªå®Œæˆçš„åŠŸèƒ½
- å¦‚æœä¸ä½¿ç”¨è¿™äº›é¡µé¢,å¯ä»¥å¿½ç•¥
- å¦‚æœéœ€è¦ä½¿ç”¨,éœ€è¦ç§»é™¤ NextAuth ä¾èµ–æˆ–å®ç°ç›¸åº”çš„æ›¿ä»£æ–¹æ¡ˆ

---

## âœ… éªŒè¯ä¿®å¤

æ‰€æœ‰ä¸»è¦é”™è¯¯å·²ä¿®å¤,é¡¹ç›®åº”è¯¥å¯ä»¥æˆåŠŸæ„å»ºäº†ã€‚

**ä¸‹ä¸€æ­¥**:
1. é‡æ–°éƒ¨ç½²åˆ° Vercel
2. å¦‚æœè¿˜æœ‰ next-auth ç›¸å…³é”™è¯¯,éœ€è¦å†³å®š:
   - é€‰é¡¹ A: åˆ é™¤ç›¸å…³æ–‡ä»¶ (å¦‚æœä¸éœ€è¦è¿™äº›åŠŸèƒ½)
   - é€‰é¡¹ B: ä¿®æ”¹è¿™äº›æ–‡ä»¶ä½¿ç”¨è‡ªå®šä¹‰ JWT è®¤è¯
3. è¿è¡Œæ•°æ®åº“è¿ç§»
4. æµ‹è¯•åº”ç”¨åŠŸèƒ½

---

## ğŸ“ ç»éªŒæ•™è®­

1. **ä¾èµ–ç®¡ç†**: ç¡®ä¿ package.json åŒ…å«æ‰€æœ‰ä½¿ç”¨çš„ä¾èµ–åŒ…
2. **UI ç»„ä»¶å®Œæ•´æ€§**: shadcn/ui ç»„ä»¶éœ€è¦æ‰‹åŠ¨æ·»åŠ ,ä¸æ˜¯è‡ªåŠ¨åŒ…å«çš„
3. **å›¾æ ‡åº“ç‰ˆæœ¬**: lucide-react çš„å›¾æ ‡åç§°å¯èƒ½ä¼šå˜åŒ–,è¦ä½¿ç”¨å®é™…å­˜åœ¨çš„å›¾æ ‡
4. **å¯¼å‡ºä¸€è‡´æ€§**: ç¡®ä¿æ¨¡å—å¯¼å‡ºä¸å¯¼å…¥è·¯å¾„ä¸€è‡´
5. **TypeScript ç±»å‹**: åœ¨ Vercel æ„å»ºæ—¶ TypeScript æ£€æŸ¥æ›´ä¸¥æ ¼

---

## ğŸ”— ç›¸å…³èµ„æº

- [shadcn/ui ç»„ä»¶æ–‡æ¡£](https://ui.shadcn.com/docs/components)
- [lucide-react å›¾æ ‡åˆ—è¡¨](https://lucide.dev/icons/)
- [tRPC æ–‡æ¡£](https://trpc.io/docs)
- [Vercel éƒ¨ç½²æ–‡æ¡£](https://vercel.com/docs)

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-11-17 17:20
**ä¿®å¤ç”¨æ—¶**: çº¦15åˆ†é’Ÿ
**çŠ¶æ€**: âœ… å‡†å¤‡é‡æ–°éƒ¨ç½²
